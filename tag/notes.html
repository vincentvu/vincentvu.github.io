<!DOCTYPE html>
<html lang="english">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vincent Vu's Blog | articles tagged "notes"</title>
    <link rel="shortcut icon" type="image/png" href="/favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />
    <link rel="stylesheet" href="/theme/css/pygments.css" type="text/css" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="Vincent Vu" />
</head>
<body>
    <header>
        <nav style="overflow: hidden;">
            <ul>
                <li class="ephemeral selected"><a href="/tag/notes.html">notes</a></li>
                <li><a href="/">Home</a></li>
                <li><a href="/pages/about.html">About</a></li>
            </ul>
        </nav>
        <div class="header_box" style="height: 50px">
        <h1><a href="/">
            <image src='' class="avatar" width="50px" /><span class="site_title">Vincent Vu's Blog</span>
            </a></h1></div>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Aug 08, 2023</h4>

            <article class="post">
                <h2 class="title">
                    <a href="/posts/2023/08/bash-shell-cheatsheet/" rel="bookmark" title="Permanent Link to &quot;Bash Shell Cheatsheet&quot;">Bash Shell Cheatsheet</a>
                </h2>

                
                

                <blockquote>
<p><strong><em>NOTE:</em></strong>  The content in this page is my personal note which I got from multiple sources and based on my personal experience.</p>
</blockquote>
<h3>File Redirection</h3>
<div class="highlight"><pre><span></span><code>&gt; file      Create file
&gt;&gt; file     Append to file
&lt; file      Read from file
a | b       Pipe a as input to b
</code></pre></div>

<h3>Read text file line by line</h3>
<div class="highlight"><pre><span></span><code><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>f<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;line is </span><span class="nv">$f</span><span class="s2">&quot;</span>
<span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>file
</code></pre></div>

<h3>While loop</h3>
<div class="highlight"><pre><span></span><code><span class="nv">a</span><span class="o">=</span><span class="m">0</span>
<span class="k">while</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$a</span><span class="s2">&quot;</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">]</span><span class="w">    </span><span class="c1"># this is loop1</span>
<span class="k">do</span>
<span class="w">   </span><span class="nv">b</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$a</span><span class="s2">&quot;</span>
<span class="w">   </span><span class="k">while</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$b</span><span class="s2">&quot;</span><span class="w"> </span>-ge<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="w">  </span><span class="c1"># this is loop2</span>
<span class="w">   </span><span class="k">do</span>
<span class="w">      </span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$b</span><span class="s2"> &quot;</span>
<span class="w">      </span><span class="nv">b</span><span class="o">=</span><span class="sb">`</span>expr<span class="w"> </span><span class="nv">$b</span><span class="w"> </span>-<span class="w"> </span><span class="m">1</span><span class="sb">`</span>
<span class="w">   </span><span class="k">done</span>
<span class="w">   </span><span class="nb">echo</span>
<span class="w">   </span><span class="nv">a</span><span class="o">=</span><span class="sb">`</span>expr<span class="w"> </span><span class="nv">$a</span><span class="w"> </span>+<span class="w"> </span><span class="m">1</span><span class="sb">`</span>
<span class="k">done</span>
</code></pre></div>

<h3>For loop</h3>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span>var<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">9</span>
<span class="k">do</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$var</span>
<span class="k">done</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span>FILE<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$HOME</span>/.bash*
<span class="k">do</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$FILE</span>
<span class="k">done</span>
</code></pre></div>

<h3>Until loop</h3>
<div class="highlight"><pre><span></span><code><span class="nv">a</span><span class="o">=</span><span class="m">0</span>
<span class="k">until</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span><span class="nv">$a</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">]</span>
<span class="k">do</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$a</span>
<span class="w">   </span><span class="nv">a</span><span class="o">=</span><span class="sb">`</span>expr<span class="w"> </span><span class="nv">$a</span><span class="w"> </span>+<span class="w"> </span><span class="m">1</span><span class="sb">`</span>
<span class="k">done</span>
</code></pre></div>

<h3>Select loop</h3>
<p>The select loop provides an easy way to create a numbered menu from which users can select options. It is useful when you need to ask the user to choose one or more items from a list of choices.</p>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span>var<span class="w"> </span><span class="k">in</span><span class="w"> </span>word1<span class="w"> </span>word2<span class="w"> </span>...<span class="w"> </span>wordN
<span class="k">do</span>
<span class="w">   </span>Statement<span class="o">(</span>s<span class="o">)</span><span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>executed<span class="w"> </span><span class="k">for</span><span class="w"> </span>every<span class="w"> </span>word.
<span class="k">done</span>
</code></pre></div>

<p>Here var is the name of a variable and word1 to wordN are sequences of characters separated by spaces (words). Each time the for loop executes, the value of the variable var is set to the next word in the list of words, word1 to wordN.</p>
<p>For every selection a set of commands would be executed with-in the loop. This loop was introduced in ksh and has been adapted into bash. It is not available in sh.</p>
<p>Here is a simple example to let the user select a drink of choice </p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/ksh</span>

<span class="k">select</span><span class="w"> </span>DRINK<span class="w"> </span><span class="k">in</span><span class="w"> </span>tea<span class="w"> </span>cofee<span class="w"> </span>water<span class="w"> </span>juice<span class="w"> </span>appe<span class="w"> </span>all<span class="w"> </span>none
<span class="k">do</span>
<span class="w">   </span><span class="k">case</span><span class="w"> </span><span class="nv">$DRINK</span><span class="w"> </span><span class="k">in</span>
<span class="w">      </span>tea<span class="p">|</span>cofee<span class="p">|</span>water<span class="p">|</span>all<span class="o">)</span><span class="w"> </span>
<span class="w">         </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Go to canteen&quot;</span>
<span class="w">         </span><span class="p">;;</span>
<span class="w">      </span>juice<span class="p">|</span>appe<span class="o">)</span>
<span class="w">         </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Available at home&quot;</span>
<span class="w">      </span><span class="p">;;</span>
<span class="w">      </span>none<span class="o">)</span><span class="w"> </span>
<span class="w">         </span><span class="k">break</span><span class="w"> </span>
<span class="w">      </span><span class="p">;;</span>
<span class="w">      </span>*<span class="o">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ERROR: Invalid selection&quot;</span><span class="w"> </span>
<span class="w">      </span><span class="p">;;</span>
<span class="w">   </span><span class="k">esac</span>
<span class="k">done</span>
</code></pre></div>

<p>The menu presented by the select loop looks like the following </p>
<div class="highlight"><pre><span></span><code>$./test.sh
<span class="m">1</span><span class="o">)</span><span class="w"> </span>tea
<span class="m">2</span><span class="o">)</span><span class="w"> </span>cofee
<span class="m">3</span><span class="o">)</span><span class="w"> </span>water
<span class="m">4</span><span class="o">)</span><span class="w"> </span>juice
<span class="m">5</span><span class="o">)</span><span class="w"> </span>appe
<span class="m">6</span><span class="o">)</span><span class="w"> </span>all
<span class="m">7</span><span class="o">)</span><span class="w"> </span>none
<span class="c1">#? juice</span>
Available<span class="w"> </span>at<span class="w"> </span>home
<span class="c1">#? none</span>
$
</code></pre></div>

<p>You can change the prompt displayed by the select loop by altering the variable PS3 as follows −</p>
<div class="highlight"><pre><span></span><code><span class="o">$</span><span class="n">PS3</span><span class="o">=</span><span class="s2">&quot;Please make a selection =&gt; &quot;</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">export</span><span class="w"> </span><span class="n">PS3</span>
<span class="o">$./</span><span class="n">test</span><span class="o">.</span><span class="n">sh</span>
<span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">tea</span>
<span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">cofee</span>
<span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="n">water</span>
<span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="n">juice</span>
<span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="n">appe</span>
<span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="n">all</span>
<span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="n">none</span>
<span class="n">Please</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">selection</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">juice</span>
<span class="n">Available</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">home</span>
<span class="n">Please</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">selection</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">none</span>
<span class="o">$</span>
</code></pre></div>

<p>Get output of ls into variable</p>
<div class="highlight"><pre><span></span><code><span class="n">myvar</span><span class="o">=</span><span class="n n-Quoted">`ls`</span>

<span class="k">Function</span><span class="w"> </span><span class="n">declaration</span>

<span class="n">doubleit</span><span class="p">()</span><span class="err">{</span>
<span class="n">expr</span><span class="w"> </span><span class="n">$1</span><span class="w"> </span><span class="err">\</span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
<span class="err">}</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nv">doubleit</span><span class="w"> </span><span class="mi">3</span><span class="w">  </span>#<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">6</span>
</code></pre></div>

<p>Run cmd1; if fails, run cmd2</p>
<div class="highlight"><pre><span></span><code>cmd1 || cmd2
</code></pre></div>

<p>Run cmd1; if it works, run cmd2</p>
<div class="highlight"><pre><span></span><code>cmd1 &amp;&amp; cmd2
</code></pre></div>

<p>Test operators</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span>[<span class="w"> </span><span class="s2">&quot;$x&quot;</span><span class="w"> </span><span class="o">-</span><span class="nv">lt</span><span class="w"> </span><span class="s2">&quot;$y&quot;</span><span class="w"> </span>]<span class="c1">; then</span>
#<span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">something</span>
<span class="nv">fi</span>
</code></pre></div>

<p>Numeric tests</p>
<div class="highlight"><pre><span></span><code>lt  less than
gt
eq
ne
ge
le
</code></pre></div>

<h3>File tests</h3>
<div class="highlight"><pre><span></span><code>nt  newer than
d   is a directory
f   is a file
x   executable
r   redable
w   writable
</code></pre></div>

<h3>String tests</h3>
<div class="highlight"><pre><span></span><code>=   equal to
z   zero length
n   not zero length
</code></pre></div>

<h3>Logical test</h3>
<div class="highlight"><pre><span></span><code>&amp;&amp;
||
!
</code></pre></div>

<h3>Arguments</h3>
<div class="highlight"><pre><span></span><code>$0
$1
...
$#  no of arguments
$*  all arguments
</code></pre></div>

<h3>Variable substitution</h3>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="p">{</span><span class="nv">V</span><span class="o">:-</span><span class="s s-Atom">default</span><span class="p">}</span>   <span class="err">$</span><span class="nv">V</span><span class="p">,</span> <span class="s s-Atom">or</span> <span class="s2">&quot;default if unset</span>
<span class="s2">${V:=default}   $V (set to &quot;</span><span class="s s-Atom">default</span><span class="s2">&quot; if unset)</span>
<span class="s2">${V:?err}   $, or &quot;</span><span class="s s-Atom">err</span><span class="err">&quot;</span> <span class="s s-Atom">if</span> <span class="s s-Atom">unset</span>
</code></pre></div>

<h3>Preset Varibales</h3>
<div class="highlight"><pre><span></span><code>$<span class="nv">SHELL</span><span class="w">      </span><span class="nv">What</span><span class="w"> </span><span class="nv">shell</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">running</span>
$<span class="k">RANDOM</span><span class="w">     </span><span class="nv">Provides</span><span class="w"> </span><span class="k">random</span><span class="w"> </span><span class="nv">number</span>
$<span class="nv">SECONDS</span><span class="w">    </span><span class="nv">Number</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">seconds</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">shell</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">started</span>
$$<span class="w">      </span><span class="nv">PID</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">current</span><span class="w"> </span><span class="nv">process</span>
$?<span class="w">      </span><span class="k">Return</span><span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">last</span><span class="w"> </span><span class="nv">command</span>
$<span class="o">!</span><span class="w">      </span><span class="nv">PID</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">last</span><span class="w"> </span><span class="nv">background</span><span class="w"> </span><span class="nv">cmd</span>
$<span class="nv">USER</span><span class="w">       </span><span class="nv">The</span><span class="w"> </span><span class="nv">username</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">user</span><span class="w"> </span><span class="nv">running</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">script</span>.
$<span class="nv">HOSTNAME</span><span class="w">   </span><span class="nv">The</span><span class="w"> </span><span class="nv">hostname</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">machine</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">script</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">running</span><span class="w"> </span><span class="nv">on</span>.
$<span class="nv">LINENO</span><span class="w">     </span><span class="nv">Returns</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">current</span><span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="nv">number</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">Bash</span><span class="w"> </span><span class="nv">script</span>.
</code></pre></div>

<h3>Passing an indirect reference to a function</h3>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># ind-func.sh: Passing an indirect reference to a function.</span>

echo_var<span class="w"> </span><span class="o">()</span>
<span class="o">{</span>
<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="nv">message</span><span class="o">=</span>Hello
<span class="nv">Hello</span><span class="o">=</span>Goodbye

echo_var<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$message</span><span class="s2">&quot;</span><span class="w">        </span><span class="c1"># Hello</span>
<span class="c1"># Now, let&#39;s pass an indirect reference to the function.</span>
echo_var<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="p">!message</span><span class="si">}</span><span class="s2">&quot;</span><span class="w">     </span><span class="c1"># Goodbye</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;-------------&quot;</span>

<span class="c1"># What happens if we change the contents of &quot;hello&quot; variable?</span>
<span class="nv">Hello</span><span class="o">=</span><span class="s2">&quot;Hello, again!&quot;</span>
echo_var<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$message</span><span class="s2">&quot;</span><span class="w">        </span><span class="c1"># Hello</span>
echo_var<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="p">!message</span><span class="si">}</span><span class="s2">&quot;</span><span class="w">     </span><span class="c1"># Hello, again!</span>

<span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</code></pre></div>

<h3>Read input from command line</h3>
<div class="highlight"><pre><span></span><code><span class="nb">read</span><span class="w"> </span>-s<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;Enter your password for encryption: &quot;</span><span class="w"> </span>pass
<span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="si">${</span><span class="nv">pass</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>my_encoding_script
</code></pre></div>

<h3>Shell script with parameter expansion</h3>
<p>Here is a bash script with parameter expansion which used for managing PostgreSQL database. You can use this script as a template to create a script to manage your systems like database, cloud, etc. </p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$_FAILHARD</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;false&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$_FAILHARD</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;False&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span>+e<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span>-e
<span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$_DEBUG</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$_DEBUG</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;True&quot;</span><span class="w"> </span><span class="o">]</span><span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span>-x<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span>+x

<span class="c1"># REF LINK: http://mywiki.wooledge.org/BashSheet#Parameter_Operations</span>

<span class="nb">export</span><span class="w"> </span><span class="nv">PGHOST</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PGUSER</span><span class="o">=</span><span class="si">${</span><span class="nv">POSTGRES_USER</span><span class="si">}</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PGPASSWORD</span><span class="o">=</span><span class="si">${</span><span class="nv">POSTGRES_PASSWORD</span><span class="si">}</span>


usage<span class="w"> </span><span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;This script will create new database:</span>
<span class="s2">Usage: </span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>rev<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w">  </span>-f<span class="w"> </span>-1<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>rev<span class="k">)</span><span class="s2"> --database=&lt;database&gt; --db-user=&lt;database-user&gt; --db-password=&lt;database-password&gt;</span>

<span class="s2">Options:</span>
<span class="s2">  - database: database name to be created.</span>
<span class="s2">  - db-user: the owner of database.</span>
<span class="s2">  - db-password: the password for database user</span>
<span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Get options from command line</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<span class="k">do</span>
<span class="k">case</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="k">in</span>
<span class="w">    </span>--help<span class="o">)</span>
<span class="w">    </span>usage<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">exit</span>
<span class="w">    </span><span class="nb">shift</span><span class="w"> </span>
<span class="w">    </span><span class="p">;;</span>
<span class="w">    </span>-u<span class="o">=</span>*<span class="p">|</span>--db-user<span class="o">=</span>*<span class="o">)</span>
<span class="w">    </span><span class="nv">DB_USER</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">i</span><span class="p">#*=</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">shift</span><span class="w"> </span>
<span class="w">    </span><span class="p">;;</span>
<span class="w">    </span>-P<span class="o">=</span>*<span class="p">|</span>--db-password<span class="o">=</span>*<span class="o">)</span>
<span class="w">    </span><span class="nv">DB_PASSWORD</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">i</span><span class="p">#*=</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">shift</span><span class="w"> </span>
<span class="w">    </span><span class="p">;;</span>
<span class="w">    </span>-d<span class="o">=</span>*<span class="p">|</span>--database<span class="o">=</span>*<span class="o">)</span>
<span class="w">    </span><span class="nv">DATABASE</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">i</span><span class="p">#*=</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">shift</span><span class="w"> </span>
<span class="w">    </span><span class="p">;;</span>
<span class="w">    </span>*<span class="o">)</span>
<span class="w">    </span><span class="c1"># unknown option</span>
<span class="w">    </span><span class="p">;;</span>
<span class="k">esac</span>
<span class="k">done</span>

<span class="c1"># Check input parameters</span>
<span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$DATABASE</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[+] --database option is needed.&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>usage<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$DB_USER</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[+] --db-use option is needed.&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>usage<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$DB_PASSWORD</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[+] --db-password option is needed.&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>usage<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>

<span class="c1"># Create database</span>
psql<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">CREATE DATABASE $DATABASE;</span>
<span class="s">CREATE USER $DB_USER WITH ENCRYPTED PASSWORD &#39;$DB_PASSWORD&#39;;</span>
<span class="s">ALTER DATABASE $DATABASE OWNER TO $DB_USER;</span>
<span class="s">EOF</span>
</code></pre></div>
                <div class="clear"></div>

                <div class="info">
                    &nbsp;&middot;&nbsp;<a href="/category/devops.html" rel="tag">DevOps</a>
                    &nbsp;&middot;
                    &nbsp;<a href="/tag/notes.html" class="tags selected">notes</a>
                    &nbsp;<a href="/tag/bash.html" class="tags">bash</a>
                </div>
            </article>            <h4 class="date">Aug 08, 2023</h4>

            <article class="post">
                <h2 class="title">
                    <a href="/posts/2023/08/java-keystore-cheatsheet/" rel="bookmark" title="Permanent Link to &quot;Java Keystore Cheatsheet&quot;">Java Keystore Cheatsheet</a>
                </h2>

                
                

                <h3>Create a java keystore</h3>
<div class="highlight"><pre><span></span><code><span class="n">keytool</span><span class="w"> </span><span class="o">-</span><span class="n">importcert</span><span class="w"> </span><span class="o">-</span><span class="n">trustcacerts</span><span class="w"> </span><span class="o">-</span><span class="n">file</span><span class="w"> </span><span class="n">example</span><span class="o">-</span><span class="n">cert</span><span class="o">.</span><span class="n">pem</span><span class="w"> </span><span class="o">-</span><span class="n">alias</span><span class="w"> </span><span class="n">ca</span><span class="w"> </span><span class="o">-</span><span class="n">keystore</span><span class="w"> </span><span class="n">keystore</span><span class="o">.</span><span class="n">jks</span>
</code></pre></div>

<h3>List content of the key</h3>
<div class="highlight"><pre><span></span><code><span class="n">keytool</span> <span class="o">-</span><span class="nb">list</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">keystore</span> <span class="n">keystore</span><span class="o">.</span><span class="n">jks</span>
 <span class="err">```</span>

<span class="c1">### import .crt and .key files into jks</span>
<span class="err">```</span><span class="n">bash</span>
<span class="n">openssl</span> <span class="n">pkcs12</span> <span class="o">-</span><span class="n">export</span> <span class="o">-</span><span class="ow">in</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">tls</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">logstash</span><span class="o">-</span><span class="n">forwarder</span><span class="o">.</span><span class="n">crt</span> <span class="o">-</span><span class="n">inkey</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">tls</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">logstash</span><span class="o">-</span><span class="n">forwarder</span><span class="o">.</span><span class="n">key</span> <span class="o">-</span><span class="n">out</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">tls</span><span class="o">/</span><span class="n">keystore</span><span class="o">/</span><span class="n">logstash</span><span class="o">-</span><span class="n">forwarder</span><span class="o">.</span><span class="n">p12</span>

<span class="n">keytool</span> <span class="o">-</span><span class="n">importkeystore</span> <span class="o">-</span><span class="n">srckeystore</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">tls</span><span class="o">/</span><span class="n">keystore</span><span class="o">/</span><span class="n">logstash</span><span class="o">-</span><span class="n">forwarder</span><span class="o">.</span><span class="n">p12</span>\
        <span class="o">-</span><span class="n">srcstoretype</span> <span class="n">PKCS12</span> \
        <span class="o">-</span><span class="n">destkeystore</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">tls</span><span class="o">/</span><span class="n">keystore</span><span class="o">/</span><span class="n">logstash</span><span class="o">-</span><span class="n">forwarder</span><span class="o">.</span><span class="n">jks</span> \
        <span class="o">-</span><span class="n">deststoretype</span> <span class="n">JKS</span>
</code></pre></div>

<h3>Get key file content</h3>
<div class="highlight"><pre><span></span><code>keytool<span class="w"> </span>-v<span class="w"> </span>-list<span class="w"> </span>-keystore<span class="w">   </span>/etc/pki/tls/keystore/logstash-forwarder.jks
</code></pre></div>
                <div class="clear"></div>

                <div class="info">
                    &nbsp;&middot;&nbsp;<a href="/category/devops.html" rel="tag">DevOps</a>
                    &nbsp;&middot;
                    &nbsp;<a href="/tag/notes.html" class="tags selected">notes</a>
                    &nbsp;<a href="/tag/bash.html" class="tags">bash</a>
                </div>
            </article>            <h4 class="date">Aug 08, 2023</h4>

            <article class="post">
                <h2 class="title">
                    <a href="/posts/2023/08/openssl-cheatsheet/" rel="bookmark" title="Permanent Link to &quot;OpenSSL Cheatsheet&quot;">OpenSSL Cheatsheet</a>
                </h2>

                
                

                <blockquote>
<p><strong><em>NOTE:</em></strong>  The content in this page is my personal note which I got from multiple sources and based on my personal experience.</p>
</blockquote>
<h3>Generate a new RSA key only</h3>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>genrsa<span class="w"> </span>-aes256<span class="w"> </span>-out<span class="w"> </span>example.key<span class="w"> </span><span class="m">2048</span><span class="w">  </span>
</code></pre></div>

<h3>Create public key from private key</h3>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>rsa<span class="w"> </span>-in<span class="w"> </span>example.key<span class="w"> </span>-pubout<span class="w"> </span>-out<span class="w"> </span>example.pub
</code></pre></div>

<h3>Generate SSH key from private key</h3>
<div class="highlight"><pre><span></span><code>ssh-keygen<span class="w">  </span>-y<span class="w"> </span>-f<span class="w"> </span>example.key
</code></pre></div>

<h3>Check OpenSSL files</h3>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>rsa<span class="w"> </span>-in<span class="w"> </span>example.key<span class="w"> </span>-noout<span class="w"> </span>-text
openssl<span class="w"> </span>x509<span class="w"> </span>-in<span class="w"> </span>filename.crt<span class="w"> </span>-text<span class="w"> </span>-noout
openssl<span class="w"> </span>req<span class="w"> </span>-in<span class="w"> </span>filename.csr<span class="w"> </span>-text<span class="w"> </span>-noout
openssl<span class="w"> </span>rsa<span class="w"> </span>-in<span class="w"> </span>filename.key<span class="w"> </span>-text<span class="w"> </span>-noout
</code></pre></div>

<h3>Generating a Self-Signed Certificate</h3>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-in<span class="w"> </span>server.csr<span class="w"> </span>-signkey<span class="w"> </span>server.key<span class="w"> </span>-out<span class="w"> </span>server.crt
</code></pre></div>

<h3>Generate a Certificate Signing Request and new Key</h3>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-keyout<span class="w"> </span>new.key<span class="w"> </span>-out<span class="w"> </span>new.csr<span class="w"> </span>-nodes
</code></pre></div>

<h3>Encrypt/Decrypt a file in base64 format</h3>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>aes-256-cbc<span class="w"> </span>-a<span class="w"> </span>-in<span class="w"> </span>plaintext.file<span class="w"> </span>-out<span class="w"> </span>encryted.file
openssl<span class="w"> </span>aes-256-cbc<span class="w"> </span>-a<span class="w"> </span>-in<span class="w"> </span>encryted.file
</code></pre></div>

<h3>Package cert in a PKCS12 file</h3>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>pkcs12<span class="w"> </span>-export<span class="w"> </span>-in<span class="w"> </span>example.crt<span class="w"> </span>-inkey<span class="w"> </span>example.key<span class="w"> </span>-out<span class="w"> </span>example.p12
</code></pre></div>

<h3>Create certificate request</h3>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-key<span class="w"> </span>graylog.key<span class="w"> </span>-subj<span class="w"> </span><span class="s1">&#39;/C=CA/ST=ON/L=Toronto/O=IT Insfrastructure/OU=DevOps/CN=example.com/emailAddress=admin@exampl.com&#39;</span><span class="w"> </span>-out<span class="w"> </span>graylog.csr<span class="w">  </span>-config<span class="w"> </span>openssl.cnf
</code></pre></div>

<h3>Create certificate</h3>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-extensions<span class="w"> </span>v3_req<span class="w"> </span>-in<span class="w"> </span>graylog.csr<span class="w"> </span>-signkey<span class="w"> </span>graylog.key<span class="w"> </span>-out<span class="w"> </span>graylog.crt<span class="w"> </span>-extfile<span class="w"> </span>openssl.cnf
</code></pre></div>
                <div class="clear"></div>

                <div class="info">
                    &nbsp;&middot;&nbsp;<a href="/category/devops.html" rel="tag">DevOps</a>
                    &nbsp;&middot;
                    &nbsp;<a href="/tag/notes.html" class="tags selected">notes</a>
                    &nbsp;<a href="/tag/bash.html" class="tags">bash</a>
                    &nbsp;<a href="/tag/openssl.html" class="tags">openssl</a>
                </div>
            </article>

        </div>
        <div class="clear"></div>
    </div>
</body>
</html>