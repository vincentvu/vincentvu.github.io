<!DOCTYPE html>
<html lang="english">
<head>
        <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vincent Vu's Blog | Sample Bash Script With Parameter Expansion</title>
    <link rel="shortcut icon" type="image/png" href="/favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />
    <link rel="stylesheet" href="/theme/css/pygments.css" type="text/css" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="Vincent Vu" />

    <meta name="keywords" content="notes,bash" />
</head>
<body>
    <header>
        <nav style="overflow: hidden;">
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/pages/about.html">About</a></li>
            </ul>
        </nav>
        <div class="header_box" style="height: 50px">
        <h1><a href="/">
            <image src='' class="avatar" width="50px" /><span class="site_title">Vincent Vu's Blog</span>
            </a></h1></div>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Aug 08, 2023</h4>

            <article class="post">
                <h2 class="title">
                    <a href="/posts/2023/08/sample-bash-script-with-parameter-expansion/" rel="bookmark" title="Permanent Link to &quot;Sample Bash Script With Parameter Expansion&quot;">Sample Bash Script With Parameter Expansion</a>
                </h2>

                
                

                <p>Here is a bash script with parameter expansion which used for managing PostgreSQL database. You can use this script as a template to create a script to manage your systems like database, cloud, etc. </p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$_FAILHARD</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;false&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$_FAILHARD</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;False&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span>+e<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span>-e
<span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$_DEBUG</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$_DEBUG</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;True&quot;</span><span class="w"> </span><span class="o">]</span><span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span>-x<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span>+x

<span class="c1"># REF LINK: http://mywiki.wooledge.org/BashSheet#Parameter_Operations</span>

<span class="nb">export</span><span class="w"> </span><span class="nv">PGHOST</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PGUSER</span><span class="o">=</span><span class="si">${</span><span class="nv">POSTGRES_USER</span><span class="si">}</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">PGPASSWORD</span><span class="o">=</span><span class="si">${</span><span class="nv">POSTGRES_PASSWORD</span><span class="si">}</span>


usage<span class="w"> </span><span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;This script will create new database:</span>
<span class="s2">Usage: </span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>rev<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w">  </span>-f<span class="w"> </span>-1<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>rev<span class="k">)</span><span class="s2"> --database=&lt;database&gt; --db-user=&lt;database-user&gt; --db-password=&lt;database-password&gt;</span>

<span class="s2">Options:</span>
<span class="s2">  - database: database name to be created.</span>
<span class="s2">  - db-user: the owner of database.</span>
<span class="s2">  - db-password: the password for database user</span>
<span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Get options from command line</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<span class="k">do</span>
<span class="k">case</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="k">in</span>
<span class="w">    </span>--help<span class="o">)</span>
<span class="w">    </span>usage<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">exit</span>
<span class="w">    </span><span class="nb">shift</span><span class="w"> </span>
<span class="w">    </span><span class="p">;;</span>
<span class="w">    </span>-u<span class="o">=</span>*<span class="p">|</span>--db-user<span class="o">=</span>*<span class="o">)</span>
<span class="w">    </span><span class="nv">DB_USER</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">i</span><span class="p">#*=</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">shift</span><span class="w"> </span>
<span class="w">    </span><span class="p">;;</span>
<span class="w">    </span>-P<span class="o">=</span>*<span class="p">|</span>--db-password<span class="o">=</span>*<span class="o">)</span>
<span class="w">    </span><span class="nv">DB_PASSWORD</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">i</span><span class="p">#*=</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">shift</span><span class="w"> </span>
<span class="w">    </span><span class="p">;;</span>
<span class="w">    </span>-d<span class="o">=</span>*<span class="p">|</span>--database<span class="o">=</span>*<span class="o">)</span>
<span class="w">    </span><span class="nv">DATABASE</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">i</span><span class="p">#*=</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">shift</span><span class="w"> </span>
<span class="w">    </span><span class="p">;;</span>
<span class="w">    </span>*<span class="o">)</span>
<span class="w">    </span><span class="c1"># unknown option</span>
<span class="w">    </span><span class="p">;;</span>
<span class="k">esac</span>
<span class="k">done</span>

<span class="c1"># Check input parameters</span>
<span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$DATABASE</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[+] --database option is needed.&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>usage<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$DB_USER</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[+] --db-use option is needed.&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>usage<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="nv">$DB_PASSWORD</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;[+] --db-password option is needed.&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>usage<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>

<span class="c1"># Create database</span>
psql<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">CREATE DATABASE $DATABASE;</span>
<span class="s">CREATE USER $DB_USER WITH ENCRYPTED PASSWORD &#39;$DB_PASSWORD&#39;;</span>
<span class="s">ALTER DATABASE $DATABASE OWNER TO $DB_USER;</span>
<span class="s">EOF</span>
</code></pre></div>
                <div class="clear"></div>

                <div class="info">
                    <a href="/posts/2023/08/sample-bash-script-with-parameter-expansion/">posted at 14:00</a>
                    &nbsp;&middot;&nbsp;<a href="/category/devops.html" rel="tag">DevOps</a>
                    &nbsp;&middot;
                    &nbsp;<a href="/tag/notes.html" class="tags">notes</a>
                    &nbsp;<a href="/tag/bash.html" class="tags">bash</a>
                </div>
            </article>
        </div>
        <div class="clear"></div>
    </div>
</body>
</html>